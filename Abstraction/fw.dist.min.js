"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Application=function e(t,n){if(_classCallCheck(this,e),!i)var i=new Sandbox;var s=n(i),a=function(){function e(t){_classCallCheck(this,e),this.element=t,this.sandbox=new Sandbox(this),this.modules=[],this.define(s),this.load(),this.init()}return _createClass(e,[{key:"define",value:function(e){for(var t in e)e[t].bind?this[t]=e[t].bind(this):this[t]=e[t]}},{key:"register",value:function(e){e=new e(this.sandbox),this.modules.push(e)}},{key:"startAll",value:function(){this.modules.forEach(function(e){e.load(this.element,function(e){e.init&&e.init.bind(e)()})}.bind(this))}},{key:"destroy",value:function(){this.modules.forEach(function(e){e.unload(),e.destroy}.bind(this))}},{key:"load",value:function(e){var t=document.createElement("div");t.innerHTML=this.template,t=t.children[0],this.element.appendChild(t),this.element=t}},{key:"get",value:function(e,t){var n=new XMLHttpRequest;n.addEventListener("load",function(){t(this.responseText)}),n.open("GET",e),n.send()}}]),e}();return a.prototype.title=t,a},Module=function Module(moduleDefinition){_classCallCheck(this,Module);var newModule=function(){function newModule(e){_classCallCheck(this,newModule),this.sandbox=e;var t=this.definition(e);this.define(t)}return _createClass(newModule,[{key:"define",value:function(e){for(var t in e)e[t].bind?this[t]=e[t].bind(this):this[t]=e[t]}},{key:"load",value:function(e,t){this.element=e,this.template?(this.processLayout(),t(this)):this.sandbox.requestLayout(this.templateUrl,function(e){this.template=e,this.processLayout(),t(this)}.bind(this))}},{key:"processLayout",value:function(){var e=document.createElement("div");e.innerHTML=this.template,e=e.children[0],this.element.appendChild(e),this.element=e,[].forEach.call(this.element.querySelectorAll("[ref]"),this.attachReference.bind(this)),[].forEach.call(this.element.querySelectorAll("[click]"),function(e){this.attachEvent("click",e)}.bind(this)),[].forEach.call(this.element.querySelectorAll("[template]"),this.attachTemplate.bind(this))}},{key:"attachReference",value:function(e){this.refs||(this.refs={}),this.refs[e.getAttribute("ref")]=e}},{key:"attachTemplate",value:function(e){this.templates||(this.templates={}),this.templates[e.getAttribute("template")]=e.outerHTML}},{key:"attachEvent",value:function(e,t){var n=t.getAttribute(e),i=new RegExp("([^(]+)s?(([Ss]*)?)","gmi");n=n.match(i);var s=n[0],a=n[1].split("");a.pop(),a=a.join("").split(","),a=a.map(this.format),t.addEventListener("click",function(e){var t=a.indexOf("$event");-1!==t&&(a[t]=e),this[s].apply(this,a)}.bind(this))}},{key:"format",value:function format(arg){return"$event"===arg||"$e"===arg||"$evt"===arg?"$event":isNaN(parseInt(arg,10))?eval(arg):parseInt(arg,10)}}]),newModule}();return newModule.prototype.definition=moduleDefinition,newModule},Event=function(){function e(t){_classCallCheck(this,e),this.data=t,this.stopped=!1}return _createClass(e,[{key:"stopPropagation",value:function(){this.stopped=!0}},{key:"shouldExecute",value:function(){return!this.stopped}}]),e}(),Sandbox=function(){function e(t){_classCallCheck(this,e),t||(t={}),this.events={},this.core=t}return _createClass(e,[{key:"requestLayout",value:function(e,t){this.core.get(e,t)}},{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"notify",value:function(e,t){var n=new Event(t);this.events[e]&&this.events[e].forEach(function(e){n.shouldExecute()&&e(n)})}}]),e}(),Platform=function(){function e(t){_classCallCheck(this,e),this.element=document.querySelector(".applications"),this.applications=[],this.instances=[],this.root=t}return _createClass(e,[{key:"register",value:function(e){this.applications.push(e);var t=document.createElement("li");t.addEventListener("click",this.init.bind(this,e)),t.innerHTML=e.prototype.title,this.element.appendChild(t)}},{key:"init",value:function(e){this.instances.push(new e(this.root))}}]),e}();
